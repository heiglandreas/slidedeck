<!DOCTYPE html>
<!-- saved from url=(0065)https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta referrer="origin-when-cross-origin"><title>authLdap.php from heiglandreas/authLdap - Code Climate</title><link rel="stylesheet" media="screen" href="./codeclimate_bad_example_files/application-58f4e913c8d410ffb1a9ddfaf88fda69.css"><script async="" src="https://d1fc8wv8zag5ca.cloudfront.net/2.5.3/sp.js"></script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script src="./codeclimate_bad_example_files/application-fa03ba9b21a04c627c9b4ef45ebe2e99.js"></script><meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="H40I69OThEBrwZQ+FSjaCcS4tviDMqPLJrIk+fWvAPKR7Y3eeymHP+zeS3v+ZrbSpU5aMPway7shyPVJTfSp9w=="><link rel="shortcut icon" href="https://codeclimate.com/favicon.png"><link href="https://chrome.google.com/webstore/detail/phgahogocbnfilkegjdpohgkkjgahjgk" rel="chrome-webstore-item"><script src="./codeclimate_bad_example_files/ga.js" async="async"></script><script src="./codeclimate_bad_example_files/snowplow-75bb83f4e22448c8f6e3f662d6eab4d2.js"></script></head><body data-metric-state="{&quot;app&quot;:{&quot;isEnterprise&quot;:false},&quot;googleAnalytics&quot;:{&quot;isEnabled&quot;:true,&quot;account&quot;:&quot;UA-23851182-1&quot;,&quot;event&quot;:null},&quot;snowplow&quot;:{&quot;appId&quot;:&quot;codeclimate.com&quot;,&quot;cookieDomain&quot;:&quot;.codeclimate.com&quot;,&quot;eventUrl&quot;:&quot;events.fivetran.com/snowplow/leukemia_vectors&quot;,&quot;namespace&quot;:&quot;cf&quot;,&quot;schemaBaseUrl&quot;:&quot;https://codeclimate.com/analytics/schemas&quot;,&quot;repo&quot;:{&quot;id&quot;:&quot;551850dee30ba06e57004810&quot;,&quot;name&quot;:&quot;heiglandreas/authLdap&quot;,&quot;account&quot;:{&quot;id&quot;:null,&quot;name&quot;:null}}},&quot;user&quot;:{&quot;id&quot;:&quot;5456fab4e30ba01c60156795&quot;,&quot;email&quot;:&quot;github@heigl.org&quot;,&quot;createdAt&quot;:1414986420,&quot;highestMrr&quot;:null,&quot;paidAccountsCount&quot;:0},&quot;wootric&quot;:{&quot;accountToken&quot;:&quot;NPS-f3f4e47e&quot;,&quot;surveyImmediately&quot;:false}}"><header class="header"><div class="container"><div class="header__logo"><a href="https://codeclimate.com/dashboard">Code Climate</a></div><nav class="header__nav"><ul class="header__nav__menu"><li><a href="https://codeclimate.com/dashboard">Dashboard</a></li><li class="header__alert-indicator header__alert-indicator--unread"><ul class="dropdown__menu"><li class="header__post-entry header__post-entry--unread"><a href="https://codeclimate.com/changelog/58c19351c9555c0270000ebe">So fresh, so clean: Introducing our new design üõÅ<span>5 days ago</span></a></li><li class="header__post-entry header__post-entry--unread"><a href="https://codeclimate.com/changelog/58c179ae33909a3e7800244d">Introducing issue statuses<span>5 days ago</span></a></li><li class="header__post-entry header__post-entry--unread"><a href="https://codeclimate.com/changelog/58c18382c3aee90287000020">Prog rocks: Our newly released progress report üé∏<span>5 days ago</span></a></li></ul></li></ul></nav><div class="header__user header__user--signed-in dropdown"><img src="./codeclimate_bad_example_files/91998" alt="91998"><ul class="dropdown__menu"><li class="header__user-menu-item--settings"><a href="https://codeclimate.com/profile">User settings</a></li><li class="header__user-menu-item--logout"><a rel="nofollow" data-method="delete" href="https://codeclimate.com/logout">Log out</a></li></ul></div></div></header><div class="hero"><div class="container"><div class="cols cols--expand"><div class="col"><h1>heiglandreas/authLdap</h1></div><div class="col col--shrink"><a class="btn btn--small btn--star-starred" rel="nofollow" data-method="delete" href="https://codeclimate.com/stars/551850dee30ba06e57004813">Favorited</a></div></div></div></div><div class="toolbar"><div class="container"><ul><li class=""><a href="https://codeclimate.com/github/heiglandreas/authLdap">Overview</a></li><li class=""><a href="https://codeclimate.com/github/heiglandreas/authLdap/issues">Issues</a></li><li class="active"><a href="https://codeclimate.com/github/heiglandreas/authLdap/code">Code</a></li><li class=""><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/coverage_setup">Test Coverage</a></li><li class=""><a href="https://codeclimate.com/github/heiglandreas/authLdap/trends">Trends</a></li><li class=""><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/edit">Settings</a></li><li class="toolbar__item--last-build"><span>Last build 4 months ago</span></li><li class="toolbar__item--refresh"><a class="toolbar__note toolbar__note--refresh" rel="nofollow" data-method="post" href="https://codeclimate.com/github/heiglandreas/authLdap/refresh"><div class="tooltip">Refresh default branch</div>Refresh </a></li></ul></div></div><div class="content"><div class="container"><div class="file-header"><div class="file-header__title">authLdap.php<div class="grade grade--f"><span>F</span></div></div></div><ul class="tabs"><li class="active"><a href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#issues">Issues</a></li><li><a href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#source">Source</a></li></ul><div class="tabs__content"><div class="tabs__pane active" id="issues"><div class="cols" data-component-id="issues-list"><div class="col col--size-12"><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="security" data-issue-filterable-statuses=""><h4 class="h--margin-m">Avoid accessing the superglobal <code>$_POST</code> directly </h4><pre data-prism-number-start="30" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="30">    <span class="token keyword">return</span> <span class="token function">isset<span class="token punctuation">(</span></span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$default</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=9a2a49932c1cfc995b04e84462032dc3&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="security" data-issue-filterable-statuses=""><h4 class="h--margin-m">Avoid accessing the superglobal <code>$_POST</code> directly </h4><pre data-prism-number-start="30" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="30">    <span class="token keyword">return</span> <span class="token function">isset<span class="token punctuation">(</span></span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$default</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=9a2a49932c1cfc995b04e84462032dc3&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="security" data-issue-filterable-statuses=""><h4 class="h--margin-m">Avoid accessing the superglobal <code>$_SERVER</code> directly </h4><pre data-prism-number-start="38" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="38">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">array_key_exists<span class="token punctuation">(</span></span><span class="token string">'ldapOptionsSave'</span><span class="token punctuation">,</span> <span class="token global">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=d3ff3599ec7a8d27395a44133b75716b&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="security" data-issue-filterable-statuses=""><h4 class="h--margin-m">Avoid accessing the superglobal <code>$_SERVER</code> directly </h4><pre data-prism-number-start="97" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="97">    <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token global">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=d3ff3599ec7a8d27395a44133b75716b&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="complexity" data-issue-filterable-statuses=""><h4 class="h--margin-m">High overall complexity: 217 </h4><pre data-prism-number-start="1" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="1"><span class="token delimiter">&lt;?php</span></div><div class="" data-line-number="2"><span class="token operator">/</span><span class="token operator">*</span></div><div class="" data-line-number="3">Plugin Name<span class="token punctuation">:</span> AuthLDAP</div><div class="" data-line-number="4">Plugin <span class="token constant">URI</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>heiglandreas<span class="token operator">/</span>authLdap</div><div class="" data-line-number="5">Description<span class="token punctuation">:</span> This plugin allows you to <span class="token keyword">use</span> <span class="token package">your</span> existing <span class="token constant">LDAP</span> <span class="token keyword">as</span> authentication base <span class="token keyword">for</span> WordPress</div></code></pre><div class="meta">Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--docs"><a data-remodal-target="readup-f75bac77a7a153d4a44f53294a8e4249" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#">Read up</a><div class="tooltip">Read up</div></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">File is too long </h4><pre data-prism-number-start="1" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="1"><span class="token delimiter">&lt;?php</span></div><div class="" data-line-number="2"><span class="token operator">/</span><span class="token operator">*</span></div><div class="" data-line-number="3">Plugin Name<span class="token punctuation">:</span> AuthLDAP</div><div class="" data-line-number="4">Plugin <span class="token constant">URI</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>heiglandreas<span class="token operator">/</span>authLdap</div><div class="" data-line-number="5">Description<span class="token punctuation">:</span> This plugin allows you to <span class="token keyword">use</span> <span class="token package">your</span> existing <span class="token constant">LDAP</span> <span class="token keyword">as</span> authentication base <span class="token keyword">for</span> WordPress</div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=7113640cf705c70c8e43799c0e6f5c67&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">Method <code>authLdap_login</code> is too long </h4><pre data-prism-number-start="163" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="163"><span class="token keyword">function</span> <span class="token function">authLdap_login<span class="token punctuation">(</span></span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$already_md5</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div><div class="" data-line-number="164"><span class="token punctuation">{</span></div><div class="" data-line-number="165">   <span class="token comment" spellcheck="true"> // don't do anything when authLDAP is disabled</span></div><div class="" data-line-number="166">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Enabled'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="167">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP disabled in AuthLDAP plugin options (use the first option in the AuthLDAP options to enable it)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=29bf29163ea5b06d80758994a3a7ebbd&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">Cyclomatic complexity for function <code>authLdap_login</code> is too high </h4><pre data-prism-number-start="163" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="163"><span class="token keyword">function</span> <span class="token function">authLdap_login<span class="token punctuation">(</span></span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$already_md5</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div><div class="" data-line-number="164"><span class="token punctuation">{</span></div><div class="" data-line-number="165">   <span class="token comment" spellcheck="true"> // don't do anything when authLDAP is disabled</span></div><div class="" data-line-number="166">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Enabled'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="167">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP disabled in AuthLDAP plugin options (use the first option in the AuthLDAP options to enable it)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=cdf6cff9c61a0c8631e1ebcfa1d9bcb5&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">Method <code>authLdap_load_options</code> is too long </h4><pre data-prism-number-start="645" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="645"><span class="token keyword">function</span> <span class="token function">authLdap_load_options<span class="token punctuation">(</span></span><span class="token variable">$reload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div><div class="" data-line-number="646"><span class="token punctuation">{</span></div><div class="" data-line-number="647">    <span class="token keyword">static</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><div class="" data-line-number="648"><span>&nbsp;</span></div><div class="" data-line-number="649">   <span class="token comment" spellcheck="true"> // the current version for options</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=9eb54fa56160e6e2f20928a24324725f&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">Method <code>authLdap_options_panel</code> is too long </h4><pre data-prism-number-start="33" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="33"><span class="token keyword">function</span> <span class="token function">authLdap_options_panel<span class="token punctuation">(</span></span><span class="token punctuation">)</span></div><div class="" data-line-number="34"><span class="token punctuation">{</span></div><div class="" data-line-number="35">   <span class="token comment" spellcheck="true"> // inclusde style sheet</span></div><div class="" data-line-number="36">    <span class="token function">wp_enqueue_style<span class="token punctuation">(</span></span><span class="token string">'authLdap-style'</span><span class="token punctuation">,</span> <span class="token function">plugin_dir_url<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'authLdap.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="37"><span>&nbsp;</span></div><div class="" data-line-number="38"><span>&nbsp;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=8499e9243a7e97ba371b8c777af012bc&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">Method <code>authLdap_groupmap</code> is too long </h4><pre data-prism-number-start="478" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="478"><span class="token keyword">function</span> <span class="token function">authLdap_groupmap<span class="token punctuation">(</span></span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$dn</span><span class="token punctuation">)</span></div><div class="" data-line-number="479"><span class="token punctuation">{</span></div><div class="" data-line-number="480">    <span class="token variable">$authLDAPGroups</span>         <span class="token operator">=</span> <span class="token function">authLdap_sort_roles_by_capabilities<span class="token punctuation">(</span></span></div><div class="" data-line-number="481">        <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Groups'</span><span class="token punctuation">)</span></div><div class="" data-line-number="482">    <span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=885f9d234f8fefbb0b5c79e06ff6d006&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>authLDAPGroupSeparator</code>, is too long </h4><pre data-prism-number-start="80" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="80">    <span class="token variable">$authLDAPGroupSeparator</span><span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupSeparator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=0cf6453e3fe3b14e5649ad1f96150b2a&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>authLDAPGroupOverUser</code>, is too long </h4><pre data-prism-number-start="86" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="86">    <span class="token variable">$authLDAPGroupOverUser</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupOverUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=57ceee41fa562b1d10e1d72df48c56b9&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>tGroupOverUserChecked</code>, is too long </h4><pre data-prism-number-start="92" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="92">    <span class="token variable">$tGroupOverUserChecked</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPGroupOverUser</span><span class="token punctuation">)</span>  <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=0b007c421db405875b620f84bd5fd301&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>authLDAPGroupOverUser</code>, is too long </h4><pre data-prism-number-start="199" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="199">        <span class="token variable">$authLDAPGroupOverUser</span>  <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupOverUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=7e9eb2008311ee7eb29db6496377ef10&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>authLDAPGroupSeparator</code>, is too long </h4><pre data-prism-number-start="485" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="485">    <span class="token variable">$authLDAPGroupSeparator</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupSeparator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=081c543843a854861b269500f913a321&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>option_version_plugin</code>, is too long </h4><pre data-prism-number-start="650" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="650">    <span class="token variable">$option_version_plugin</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=ac22d8b6ff641c51f40f478f6cbd73f9&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>old_option_new_option</code>, is too long </h4><pre data-prism-number-start="684" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="684">            <span class="token variable">$old_option_new_option</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></div><div class="" data-line-number="685">                <span class="token string">'authLDAP'</span>              <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Enabled'</span><span class="token punctuation">,</span></div><div class="" data-line-number="686">                <span class="token string">'authLDAPCachePW'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'CachePW'</span><span class="token punctuation">,</span></div><div class="" data-line-number="687">                <span class="token string">'authLDAPURI'</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'URI'</span><span class="token punctuation">,</span></div><div class="" data-line-number="688">                <span class="token string">'authLDAPFilter'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Filter'</span><span class="token punctuation">,</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=ddff4302d0ea5bd27cd12e4a6b1de1dc&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issue" data-component-id="filterable-issue" data-issue-filterable-categories="clarity" data-issue-filterable-statuses=""><h4 class="h--margin-m">The variable name, <code>dn</code>, is too short </h4><pre data-prism-number-start="285" data-prism-annotations="[]" data-prism-coverage="[]" class=" language-php"><code class=" language-php"><div class="" data-line-number="285">            <span class="token variable">$dn</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'dn'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></code></pre><div class="meta"><div class="severity-indicator"><div class="severity-indicator__dot severity-indicator__dot--active"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="severity-indicator__dot"></div><div class="tooltip">Severity: Minor</div></div>Found in <a target="_blank" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php">authLdap.php</a></div><ul class="issue__controls"><li class="issue__control issue__control--ticket"><a href="https://codeclimate.com/repos/551850dee30ba06e57004810/services/not_setup/tickets">Create a ticket</a><div class="tooltip">Create a ticket</div></li><li class="issue__control issue__control--exclude issue__control--dropdown"><div class="tooltip">Exclude checks</div><ul class="issue__control-dropdown-menu"><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_engine">Disable engine</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?type=disable_check">Disable check</a></li><li><a data-issue-exclude-link="true" href="https://codeclimate.com/repos/551850dee30ba06e57004810/modified_configs?fingerprint=abd5cca5f7575b1c85a231cdc2bd1ad4&amp;type=ignore_issue">Ignore issue</a></li></ul></li></ul></div><div class="issues__empty-filters"><div class="message"><h3>There are no issues that match your filters.</h3></div></div></div><div class="col col--size-3 col--offset-1"><h6 class="h--margin-s">Category</h6><ul class="filter"><li class="active"><a class="active" data-issue-filter="all" data-filter-group-name="data-issue-filterable-categories" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#">All</a></li><li><a data-issue-filter="security" data-filter-group-name="data-issue-filterable-categories" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#">Security</a></li><li><a data-issue-filter="complexity" data-filter-group-name="data-issue-filterable-categories" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#">Complexity</a></li><li><a data-issue-filter="clarity" data-filter-group-name="data-issue-filterable-categories" href="https://codeclimate.com/github/heiglandreas/authLdap/authLdap.php#">Clarity</a></li></ul></div></div></div><div class="tabs__pane" id="source"><div class="prism-toggle prism-toggle--show-annotations"><div class="prism-toggle__checkboxes"><div class="checkbox"><input checked="" data-prism-toggle="annotations" id="annotations" type="checkbox"><label for="annotations">Issues</label></div></div><pre data-prism-number-start="1" data-prism-annotations="[{&quot;start&quot;:1,&quot;end&quot;:29,&quot;name&quot;:&quot;php_long_file&quot;,&quot;description&quot;:[&quot;File is too long&quot;]},{&quot;start&quot;:30,&quot;end&quot;:30,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Avoid accessing the superglobal `$_POST` directly&quot;,&quot;File is too long&quot;]},{&quot;start&quot;:31,&quot;end&quot;:32,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;]},{&quot;start&quot;:33,&quot;end&quot;:37,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:38,&quot;end&quot;:38,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Avoid accessing the superglobal `$_SERVER` directly&quot;]},{&quot;start&quot;:39,&quot;end&quot;:79,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:80,&quot;end&quot;:80,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `authLDAPGroupSeparator`, is too long&quot;]},{&quot;start&quot;:81,&quot;end&quot;:85,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:86,&quot;end&quot;:86,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `authLDAPGroupOverUser`, is too long&quot;]},{&quot;start&quot;:87,&quot;end&quot;:91,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:92,&quot;end&quot;:92,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `tGroupOverUserChecked`, is too long&quot;]},{&quot;start&quot;:93,&quot;end&quot;:96,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:97,&quot;end&quot;:97,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Avoid accessing the superglobal `$_SERVER` directly&quot;]},{&quot;start&quot;:98,&quot;end&quot;:104,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_options_panel` is too long&quot;]},{&quot;start&quot;:105,&quot;end&quot;:162,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;]},{&quot;start&quot;:163,&quot;end&quot;:198,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_login` is too long&quot;,&quot;Cyclomatic complexity for function `authLdap_login` is too high&quot;]},{&quot;start&quot;:199,&quot;end&quot;:199,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `authLDAPGroupOverUser`, is too long&quot;]},{&quot;start&quot;:200,&quot;end&quot;:284,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_login` is too long&quot;,&quot;Cyclomatic complexity for function `authLdap_login` is too high&quot;]},{&quot;start&quot;:285,&quot;end&quot;:285,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `dn`, is too short&quot;]},{&quot;start&quot;:286,&quot;end&quot;:407,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_login` is too long&quot;,&quot;Cyclomatic complexity for function `authLdap_login` is too high&quot;]},{&quot;start&quot;:408,&quot;end&quot;:477,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;]},{&quot;start&quot;:478,&quot;end&quot;:484,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Method `authLdap_groupmap` is too long&quot;]},{&quot;start&quot;:485,&quot;end&quot;:485,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `authLDAPGroupSeparator`, is too long&quot;]},{&quot;start&quot;:486,&quot;end&quot;:539,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_groupmap` is too long&quot;]},{&quot;start&quot;:540,&quot;end&quot;:644,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;]},{&quot;start&quot;:645,&quot;end&quot;:649,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;Method `authLdap_load_options` is too long&quot;]},{&quot;start&quot;:650,&quot;end&quot;:650,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `option_version_plugin`, is too long&quot;]},{&quot;start&quot;:651,&quot;end&quot;:683,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_load_options` is too long&quot;]},{&quot;start&quot;:684,&quot;end&quot;:700,&quot;name&quot;:&quot;multiple&quot;,&quot;description&quot;:[&quot;The variable name, `old_option_new_option`, is too long&quot;]},{&quot;start&quot;:701,&quot;end&quot;:724,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;,&quot;Method `authLdap_load_options` is too long&quot;]},{&quot;start&quot;:725,&quot;end&quot;:784,&quot;name&quot;:&quot;continuation&quot;,&quot;description&quot;:[&quot;File is too long&quot;]}]" data-prism-coverage="null" class=" language-php"><code class=" language-php"><div class="annotation">File is too long</div><div class="" data-line-number="1"><span class="token delimiter">&lt;?php</span></div><div class="" data-line-number="2"><span class="token operator">/</span><span class="token operator">*</span></div><div class="" data-line-number="3">Plugin Name<span class="token punctuation">:</span> AuthLDAP</div><div class="" data-line-number="4">Plugin <span class="token constant">URI</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>heiglandreas<span class="token operator">/</span>authLdap</div><div class="" data-line-number="5">Description<span class="token punctuation">:</span> This plugin allows you to <span class="token keyword">use</span> <span class="token package">your</span> existing <span class="token constant">LDAP</span> <span class="token keyword">as</span> authentication base <span class="token keyword">for</span> WordPress</div><div class="" data-line-number="6">Version<span class="token punctuation">:</span> <span class="token number">1.4</span><span class="token punctuation">.</span><span class="token number">20</span></div><div class="" data-line-number="7">Author<span class="token punctuation">:</span> Andreas Heigl <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.heigl@wdv.de</span><span class="token punctuation">&gt;</span></span></span></div><div class="" data-line-number="8">Author <span class="token constant">URI</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>andreas<span class="token punctuation">.</span>heigl<span class="token punctuation">.</span>org</div><div class="" data-line-number="9"><span class="token operator">*</span><span class="token operator">/</span></div><div class="" data-line-number="10"><span>&nbsp;</span></div><div class="" data-line-number="11"><span class="token keyword">require_once</span> <span class="token function">dirname<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/ldap.php'</span><span class="token punctuation">;</span></div><div class="" data-line-number="12"><span>&nbsp;</span></div><div class="" data-line-number="13"><span class="token keyword">function</span> <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token variable">$message</span><span class="token punctuation">)</span></div><div class="" data-line-number="14"><span class="token punctuation">{</span></div><div class="" data-line-number="15">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Debug'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="16">        <span class="token function">error_log<span class="token punctuation">(</span></span><span class="token string">'[AuthLDAP] '</span> <span class="token punctuation">.</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="17">    <span class="token punctuation">}</span></div><div class="" data-line-number="18"><span class="token punctuation">}</span></div><div class="" data-line-number="19"><span>&nbsp;</span></div><div class="" data-line-number="20"><span>&nbsp;</span></div><div class="" data-line-number="21"><span class="token keyword">function</span> <span class="token function">authLdap_addmenu<span class="token punctuation">(</span></span><span class="token punctuation">)</span></div><div class="" data-line-number="22"><span class="token punctuation">{</span></div><div class="" data-line-number="23">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">function_exists<span class="token punctuation">(</span></span><span class="token string">'add_options_page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="24">        <span class="token function">add_options_page<span class="token punctuation">(</span></span><span class="token string">'AuthLDAP'</span><span class="token punctuation">,</span> <span class="token string">'AuthLDAP'</span><span class="token punctuation">,</span> <span class="token string">'manage_options'</span><span class="token punctuation">,</span> <span class="token function">basename<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'authLdap_options_panel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="25">    <span class="token punctuation">}</span></div><div class="" data-line-number="26"><span class="token punctuation">}</span></div><div class="" data-line-number="27"><span>&nbsp;</span></div><div class="" data-line-number="28"><span class="token keyword">function</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span></div><div class="" data-line-number="29"><span class="token punctuation">{</span></div><div class="annotation">Avoid accessing the superglobal `$_POST` directly<br>File is too long</div><div class="" data-line-number="30">    <span class="token keyword">return</span> <span class="token function">isset<span class="token punctuation">(</span></span><span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token global">$_POST</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$default</span><span class="token punctuation">;</span></div><div class="" data-line-number="31"><span class="token punctuation">}</span></div><div class="" data-line-number="32"><span>&nbsp;</span></div><div class="annotation">Method `authLdap_options_panel` is too long</div><div class="" data-line-number="33"><span class="token keyword">function</span> <span class="token function">authLdap_options_panel<span class="token punctuation">(</span></span><span class="token punctuation">)</span></div><div class="" data-line-number="34"><span class="token punctuation">{</span></div><div class="" data-line-number="35">   <span class="token comment" spellcheck="true"> // inclusde style sheet</span></div><div class="" data-line-number="36">    <span class="token function">wp_enqueue_style<span class="token punctuation">(</span></span><span class="token string">'authLdap-style'</span><span class="token punctuation">,</span> <span class="token function">plugin_dir_url<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'authLdap.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="37"><span>&nbsp;</span></div><div class="annotation">Avoid accessing the superglobal `$_SERVER` directly</div><div class="" data-line-number="38">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token global">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">array_key_exists<span class="token punctuation">(</span></span><span class="token string">'ldapOptionsSave'</span><span class="token punctuation">,</span> <span class="token global">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="39">        <span class="token variable">$new_options</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></div><div class="" data-line-number="40">            <span class="token string">'Enabled'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPAuth'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="41">            <span class="token string">'CachePW'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPCachePW'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="42">            <span class="token string">'URI'</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPURI'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="43">            <span class="token string">'URISeparator'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPURISeparator'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="44">            <span class="token string">'StartTLS'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPStartTLS'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="45">            <span class="token string">'Filter'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPFilter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="46">            <span class="token string">'NameAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPNameAttr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="47">            <span class="token string">'SecName'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPSecName'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="48">            <span class="token string">'UidAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPUidAttr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="49">            <span class="token string">'MailAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPMailAttr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="50">            <span class="token string">'WebAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPWebAttr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="51">            <span class="token string">'Groups'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroups'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="52">            <span class="token string">'GroupSeparator'</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroupSeparator'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="53">            <span class="token string">'Debug'</span>         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPDebug'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="54">            <span class="token string">'GroupAttr'</span>     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroupAttr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="55">            <span class="token string">'GroupFilter'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroupFilter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="56">            <span class="token string">'DefaultRole'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPDefaultRole'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="57">            <span class="token string">'GroupEnable'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroupEnable'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="58">            <span class="token string">'GroupOverUser'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">authLdap_get_post<span class="token punctuation">(</span></span><span class="token string">'authLDAPGroupOverUser'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="59">        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="60">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">authLdap_set_options<span class="token punctuation">(</span></span><span class="token variable">$new_options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="61">            <span class="token keyword">echo</span> "<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>'updated'</span><span class="token punctuation">&gt;</span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>Saved Options<span class="token operator">!</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>"<span class="token punctuation">;</span></div><div class="" data-line-number="62">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="63">            <span class="token keyword">echo</span> "<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>'error'</span><span class="token punctuation">&gt;</span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>Could not save Options<span class="token operator">!</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>"<span class="token punctuation">;</span></div><div class="" data-line-number="64">        <span class="token punctuation">}</span></div><div class="" data-line-number="65">    <span class="token punctuation">}</span></div><div class="" data-line-number="66"><span>&nbsp;</span></div><div class="" data-line-number="67">   <span class="token comment" spellcheck="true"> // Do some initialization for the admin-view</span></div><div class="" data-line-number="68">    <span class="token variable">$authLDAP</span>              <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Enabled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="69">    <span class="token variable">$authLDAPCachePW</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'CachePW'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="70">    <span class="token variable">$authLDAPURI</span>           <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'URI'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="71">    <span class="token variable">$authLDAPURISeparator</span>  <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'URISeparator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="72">    <span class="token variable">$authLDAPStartTLS</span>      <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'StartTLS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="73">    <span class="token variable">$authLDAPFilter</span>        <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Filter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="74">    <span class="token variable">$authLDAPNameAttr</span>      <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'NameAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="75">    <span class="token variable">$authLDAPSecName</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'SecName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="76">    <span class="token variable">$authLDAPMailAttr</span>      <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'MailAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="77">    <span class="token variable">$authLDAPUidAttr</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'UidAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="78">    <span class="token variable">$authLDAPWebAttr</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'WebAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="79">    <span class="token variable">$authLDAPGroups</span>        <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Groups'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="annotation">The variable name, `authLDAPGroupSeparator`, is too long</div><div class="" data-line-number="80">    <span class="token variable">$authLDAPGroupSeparator</span><span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupSeparator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="81">    <span class="token variable">$authLDAPDebug</span>         <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="82">    <span class="token variable">$authLDAPGroupAttr</span>     <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="83">    <span class="token variable">$authLDAPGroupFilter</span>   <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupFilter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="84">    <span class="token variable">$authLDAPDefaultRole</span>   <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'DefaultRole'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="85">    <span class="token variable">$authLDAPGroupEnable</span>   <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupEnable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="annotation">The variable name, `authLDAPGroupOverUser`, is too long</div><div class="" data-line-number="86">    <span class="token variable">$authLDAPGroupOverUser</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupOverUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="87"><span>&nbsp;</span></div><div class="" data-line-number="88">    <span class="token variable">$tChecked</span>              <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAP</span><span class="token punctuation">)</span>               <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="89">    <span class="token variable">$tDebugChecked</span>         <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPDebug</span><span class="token punctuation">)</span>          <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="90">    <span class="token variable">$tPWChecked</span>            <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPCachePW</span><span class="token punctuation">)</span>        <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="91">    <span class="token variable">$tGroupChecked</span>         <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPGroupEnable</span><span class="token punctuation">)</span>    <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="annotation">The variable name, `tGroupOverUserChecked`, is too long</div><div class="" data-line-number="92">    <span class="token variable">$tGroupOverUserChecked</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPGroupOverUser</span><span class="token punctuation">)</span>  <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="93">    <span class="token variable">$tStartTLSChecked</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPStartTLS</span><span class="token punctuation">)</span>       <span class="token operator">?</span> <span class="token string">' checked="checked"'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="94"><span>&nbsp;</span></div><div class="" data-line-number="95">    <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WP_Roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="96"><span>&nbsp;</span></div><div class="annotation">Avoid accessing the superglobal `$_SERVER` directly</div><div class="" data-line-number="97">    <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token global">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="98">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">extension_loaded<span class="token punctuation">(</span></span><span class="token string">'ldap'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="99">        <span class="token keyword">echo</span> '<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></span>The <span class="token constant">LDAP</span><span class="token operator">-</span>Extension is not available on your '</div><div class="" data-line-number="100">            <span class="token punctuation">.</span> <span class="token string">'WebServer. Therefore Everything you can alter here does not '</span></div><div class="" data-line-number="101">            <span class="token punctuation">.</span> 'make any sense<span class="token operator">!</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>'<span class="token punctuation">;</span></div><div class="" data-line-number="102">    <span class="token punctuation">}</span></div><div class="" data-line-number="103"><span>&nbsp;</span></div><div class="" data-line-number="104">    <span class="token keyword">include</span> <span class="token function">dirname<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/view/admin.phtml'</span><span class="token punctuation">;</span></div><div class="" data-line-number="105"><span class="token punctuation">}</span></div><div class="" data-line-number="106"><span>&nbsp;</span></div><div class="" data-line-number="107"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="108"> * get a LDAP server object</div><div class="" data-line-number="109"> *</div><div class="" data-line-number="110"> * throws exception if there is a problem connecting</div><div class="" data-line-number="111"> *</div><div class="" data-line-number="112"> * @conf boolean authLDAPDebug true, if debugging should be turned on</div><div class="" data-line-number="113"> * @conf string  authLDAPURI LDAP server URI</div><div class="" data-line-number="114"> *</div><div class="" data-line-number="115"> * @return LDAP LDAP server object</div><div class="" data-line-number="116"> */</div><div class="" data-line-number="117"><span class="token keyword">function</span> <span class="token function">authLdap_get_server<span class="token punctuation">(</span></span><span class="token punctuation">)</span></div><div class="" data-line-number="118"><span class="token punctuation">{</span></div><div class="" data-line-number="119">    <span class="token keyword">static</span> <span class="token variable">$_ldapserver</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><div class="" data-line-number="120">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null<span class="token punctuation">(</span></span><span class="token variable">$_ldapserver</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="121">        <span class="token variable">$authLDAPDebug</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="122">        <span class="token variable">$authLDAPURI</span>   <span class="token operator">=</span> <span class="token function">explode<span class="token punctuation">(</span></span></div><div class="" data-line-number="123">            <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'URISeparator'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="124">            <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'URI'</span><span class="token punctuation">)</span></div><div class="" data-line-number="125">        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="126">        <span class="token variable">$authLDAPStartTLS</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'StartTLS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="127"><span>&nbsp;</span></div><div class="" data-line-number="128">       <span class="token comment" spellcheck="true"> //$authLDAPURI = 'ldap:/foo:bar@server/trallala';</span></div><div class="" data-line-number="129">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'connect to LDAP server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="130">        <span class="token keyword">require_once</span> <span class="token function">dirname<span class="token punctuation">(</span></span><span class="token constant">__FILE__</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/src/LdapList.php'</span><span class="token punctuation">;</span></div><div class="" data-line-number="131">        <span class="token variable">$_ldapserver</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>Org_Heigl<span class="token punctuation">\</span>AuthLdap<span class="token punctuation">\</span>LdapList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="132">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPURI</span> <span class="token keyword">as</span> <span class="token variable">$uri</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="133">            <span class="token variable">$_ldapserver</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addLdap<span class="token punctuation">(</span></span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>Org_Heigl<span class="token punctuation">\</span>AuthLdap<span class="token punctuation">\</span>LDAP</span><span class="token punctuation">(</span><span class="token variable">$uri</span><span class="token punctuation">,</span> <span class="token variable">$authLDAPDebug</span><span class="token punctuation">,</span> <span class="token variable">$authLDAPStartTLS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="134">        <span class="token punctuation">}</span></div><div class="" data-line-number="135">    <span class="token punctuation">}</span></div><div class="" data-line-number="136">    <span class="token keyword">return</span> <span class="token variable">$_ldapserver</span><span class="token punctuation">;</span></div><div class="" data-line-number="137"><span class="token punctuation">}</span></div><div class="" data-line-number="138"><span>&nbsp;</span></div><div class="" data-line-number="139"><span>&nbsp;</span></div><div class="" data-line-number="140"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="141"> * This method authenticates a user using either the LDAP or, if LDAP is not</div><div class="" data-line-number="142"> * available, the local database</div><div class="" data-line-number="143"> *</div><div class="" data-line-number="144"> * For this we store the hashed passwords in the WP_Database to ensure working</div><div class="" data-line-number="145"> * conditions even without an LDAP-Connection</div><div class="" data-line-number="146"> *</div><div class="" data-line-number="147"> * @param null|WP_User|WP_Error</div><div class="" data-line-number="148"> * @param string $username</div><div class="" data-line-number="149"> * @param string $password</div><div class="" data-line-number="150"> * @param boolean $already_md5</div><div class="" data-line-number="151"> * @return boolean true, if login was successfull or false, if it wasn't</div><div class="" data-line-number="152"> * @conf boolean authLDAP true, if authLDAP should be used, false if not. Defaults to false</div><div class="" data-line-number="153"> * @conf string authLDAPFilter LDAP filter to use to find correct user, defaults to '(uid=%s)'</div><div class="" data-line-number="154"> * @conf string authLDAPNameAttr LDAP attribute containing user (display) name, defaults to 'name'</div><div class="" data-line-number="155"> * @conf string authLDAPSecName LDAP attribute containing second name, defaults to ''</div><div class="" data-line-number="156"> * @conf string authLDAPMailAttr LDAP attribute containing user e-mail, defaults to 'mail'</div><div class="" data-line-number="157"> * @conf string authLDAPUidAttr LDAP attribute containing user id (the username we log on with), defaults to 'uid'</div><div class="" data-line-number="158"> * @conf string authLDAPWebAttr LDAP attribute containing user website, defaults to ''</div><div class="" data-line-number="159"> * @conf string authLDAPDefaultRole default role for authenticated user, defaults to ''</div><div class="" data-line-number="160"> * @conf boolean authLDAPGroupEnable true, if we try to map LDAP groups to Wordpress roles</div><div class="" data-line-number="161"> * @conf boolean authLDAPGroupOverUser true, if LDAP Groups have precedence over existing user roles</div><div class="" data-line-number="162"> */</div><div class="annotation">File is too long<br>Method `authLdap_login` is too long<br>Cyclomatic complexity for function `authLdap_login` is too high</div><div class="" data-line-number="163"><span class="token keyword">function</span> <span class="token function">authLdap_login<span class="token punctuation">(</span></span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$already_md5</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div><div class="" data-line-number="164"><span class="token punctuation">{</span></div><div class="" data-line-number="165">   <span class="token comment" spellcheck="true"> // don't do anything when authLDAP is disabled</span></div><div class="" data-line-number="166">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Enabled'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="167">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP disabled in AuthLDAP plugin options (use the first option in the AuthLDAP options to enable it)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="168">        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token punctuation">;</span></div><div class="" data-line-number="169">    <span class="token punctuation">}</span></div><div class="" data-line-number="170"><span>&nbsp;</span></div><div class="" data-line-number="171">   <span class="token comment" spellcheck="true"> // If the user has already been authenticated (only in that case we get a</span></div><div class="" data-line-number="172">   <span class="token comment" spellcheck="true"> // WP_User-Object as $user) we skip LDAP-authentication and simply return</span></div><div class="" data-line-number="173">   <span class="token comment" spellcheck="true"> // the existing user-object</span></div><div class="" data-line-number="174">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span> <span class="token keyword">instanceof</span> <span class="token class-name">WP_User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="175">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token function">sprintf<span class="token punctuation">(</span></span></div><div class="" data-line-number="176">            <span class="token string">'User %s has already been authenticated - skipping LDAP-Authentication'</span><span class="token punctuation">,</span></div><div class="" data-line-number="177">            <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get<span class="token punctuation">(</span></span><span class="token string">'nickname'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="178">        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token punctuation">;</span></div><div class="" data-line-number="179">    <span class="token punctuation">}</span></div><div class="" data-line-number="180"><span>&nbsp;</span></div><div class="" data-line-number="181">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">"User '$username' logging in"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="182"><span>&nbsp;</span></div><div class="" data-line-number="183">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="184">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Doing nothing for possible local user admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="185">        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token punctuation">;</span></div><div class="" data-line-number="186">    <span class="token punctuation">}</span></div><div class="" data-line-number="187"><span>&nbsp;</span></div><div class="" data-line-number="188">    <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">,</span> <span class="token variable">$error</span><span class="token punctuation">;</span></div><div class="" data-line-number="189">    <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div class="" data-line-number="190">        <span class="token variable">$authLDAP</span>               <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Enabled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="191">        <span class="token variable">$authLDAPFilter</span>         <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Filter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="192">        <span class="token variable">$authLDAPNameAttr</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'NameAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="193">        <span class="token variable">$authLDAPSecName</span>        <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'SecName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="194">        <span class="token variable">$authLDAPMailAttr</span>       <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'MailAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="195">        <span class="token variable">$authLDAPUidAttr</span>        <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'UidAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="196">        <span class="token variable">$authLDAPWebAttr</span>        <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'WebAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="197">        <span class="token variable">$authLDAPDefaultRole</span>    <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'DefaultRole'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="198">        <span class="token variable">$authLDAPGroupEnable</span>    <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupEnable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="annotation">The variable name, `authLDAPGroupOverUser`, is too long</div><div class="" data-line-number="199">        <span class="token variable">$authLDAPGroupOverUser</span>  <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupOverUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="200"><span>&nbsp;</span></div><div class="" data-line-number="201">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="202">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Username not supplied: return false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="203">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="204">        <span class="token punctuation">}</span></div><div class="" data-line-number="205"><span>&nbsp;</span></div><div class="" data-line-number="206">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="207">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Password not supplied: return false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="208">            <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token function">__<span class="token punctuation">(</span></span>'<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span></span>Error<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">:</span> The password field is empty<span class="token punctuation">.</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="209">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="210">        <span class="token punctuation">}</span></div><div class="" data-line-number="211">       <span class="token comment" spellcheck="true"> // First check for valid values and set appropriate defaults</span></div><div class="" data-line-number="212">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPFilter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="213">            <span class="token variable">$authLDAPFilter</span> <span class="token operator">=</span> <span class="token string">'(uid=%s)'</span><span class="token punctuation">;</span></div><div class="" data-line-number="214">        <span class="token punctuation">}</span></div><div class="" data-line-number="215">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPNameAttr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="216">            <span class="token variable">$authLDAPNameAttr</span> <span class="token operator">=</span> <span class="token string">'name'</span><span class="token punctuation">;</span></div><div class="" data-line-number="217">        <span class="token punctuation">}</span></div><div class="" data-line-number="218">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPMailAttr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="219">            <span class="token variable">$authLDAPMailAttr</span> <span class="token operator">=</span> <span class="token string">'mail'</span><span class="token punctuation">;</span></div><div class="" data-line-number="220">        <span class="token punctuation">}</span></div><div class="" data-line-number="221">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPUidAttr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="222">            <span class="token variable">$authLDAPUidAttr</span> <span class="token operator">=</span> <span class="token string">'uid'</span><span class="token punctuation">;</span></div><div class="" data-line-number="223">        <span class="token punctuation">}</span></div><div class="" data-line-number="224"><span>&nbsp;</span></div><div class="" data-line-number="225">       <span class="token comment" spellcheck="true"> // If already_md5 is TRUE, then we're getting the user/password from the cookie. As we don't want to store LDAP passwords in any</span></div><div class="" data-line-number="226">       <span class="token comment" spellcheck="true"> // form, we've already replaced the password with the hashed username and LDAP_COOKIE_MARKER</span></div><div class="" data-line-number="227">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$already_md5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="228">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token operator">==</span> <span class="token function">md5<span class="token punctuation">(</span></span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">md5<span class="token punctuation">(</span></span><span class="token variable">$ldapCookieMarker</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="229">                <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'cookie authentication'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="230">                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><div class="" data-line-number="231">            <span class="token punctuation">}</span></div><div class="" data-line-number="232">        <span class="token punctuation">}</span></div><div class="" data-line-number="233"><span>&nbsp;</span></div><div class="" data-line-number="234">       <span class="token comment" spellcheck="true"> // No cookie, so have to authenticate them via LDAP</span></div><div class="" data-line-number="235">        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="236">        <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div class="" data-line-number="237">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'about to do LDAP authentication'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="238">            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">authLdap_get_server<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Authenticate<span class="token punctuation">(</span></span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$authLDAPFilter</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="239">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="240">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP authentication failed with exception: '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="241">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="242">        <span class="token punctuation">}</span></div><div class="" data-line-number="243"><span>&nbsp;</span></div><div class="" data-line-number="244">       <span class="token comment" spellcheck="true"> // Rebind with the default credentials after the user has been loged in</span></div><div class="" data-line-number="245">       <span class="token comment" spellcheck="true"> // Otherwise the credentials of the user trying to login will be used</span></div><div class="" data-line-number="246">       <span class="token comment" spellcheck="true"> // This fixes #55</span></div><div class="" data-line-number="247">        <span class="token function">authLdap_get_server<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">bind<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="248"><span>&nbsp;</span></div><div class="" data-line-number="249">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span> <span class="token operator">!</span><span class="token operator">==</span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="250">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP authentication failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="251">           <span class="token comment" spellcheck="true"> // TODO what to return? WP_User object, true, false, even an WP_Error object... all seem to fall back to normal wp user authentication</span></div><div class="" data-line-number="252">            <span class="token keyword">return</span><span class="token punctuation">;</span></div><div class="" data-line-number="253">        <span class="token punctuation">}</span></div><div class="" data-line-number="254"><span>&nbsp;</span></div><div class="" data-line-number="255">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP authentication successfull'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="256">        <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token function">array_values<span class="token punctuation">(</span></span></div><div class="" data-line-number="257">            <span class="token function">array_filter<span class="token punctuation">(</span></span></div><div class="" data-line-number="258">                <span class="token keyword">array</span><span class="token punctuation">(</span></div><div class="" data-line-number="259">                    <span class="token variable">$authLDAPNameAttr</span><span class="token punctuation">,</span></div><div class="" data-line-number="260">                    <span class="token variable">$authLDAPSecName</span><span class="token punctuation">,</span></div><div class="" data-line-number="261">                    <span class="token variable">$authLDAPMailAttr</span><span class="token punctuation">,</span></div><div class="" data-line-number="262">                    <span class="token variable">$authLDAPWebAttr</span><span class="token punctuation">,</span></div><div class="" data-line-number="263">                    <span class="token variable">$authLDAPUidAttr</span></div><div class="" data-line-number="264">                <span class="token punctuation">)</span></div><div class="" data-line-number="265">            <span class="token punctuation">)</span></div><div class="" data-line-number="266">        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="267"><span>&nbsp;</span></div><div class="" data-line-number="268">        <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div class="" data-line-number="269">            <span class="token variable">$attribs</span> <span class="token operator">=</span> <span class="token function">authLdap_get_server<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">search<span class="token punctuation">(</span></span></div><div class="" data-line-number="270">                <span class="token function">sprintf<span class="token punctuation">(</span></span><span class="token variable">$authLDAPFilter</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="271">                <span class="token variable">$attributes</span></div><div class="" data-line-number="272">            <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="273">           <span class="token comment" spellcheck="true"> // First get all the relevant group informations so we can see if</span></div><div class="" data-line-number="274">           <span class="token comment" spellcheck="true"> // whether have been changes in group association of the user</span></div><div class="" data-line-number="275">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'dn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="276">                <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'could not get user attributes from LDAP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="277">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnexpectedValueException</span><span class="token punctuation">(</span><span class="token string">'dn has not been returned'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="278">            <span class="token punctuation">}</span></div><div class="" data-line-number="279">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPUidAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="280">                <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'could not get user attributes from LDAP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="281">                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnexpectedValueException</span><span class="token punctuation">(</span><span class="token string">'The user-ID attribute has not been returned'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="282"><span>&nbsp;</span></div><div class="" data-line-number="283">            <span class="token punctuation">}</span></div><div class="" data-line-number="284"><span>&nbsp;</span></div><div class="annotation">The variable name, `dn`, is too short</div><div class="" data-line-number="285">            <span class="token variable">$dn</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'dn'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="286">            <span class="token variable">$realuid</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPUidAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="287">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="288">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Exception getting LDAP user: '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="289">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="290">        <span class="token punctuation">}</span></div><div class="" data-line-number="291"><span>&nbsp;</span></div><div class="" data-line-number="292">        <span class="token variable">$uid</span> <span class="token operator">=</span> <span class="token function">authLdap_get_uid<span class="token punctuation">(</span></span><span class="token variable">$realuid</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="293">        <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="294"><span>&nbsp;</span></div><div class="" data-line-number="295">       <span class="token comment" spellcheck="true"> // we only need this if either LDAP groups are disabled or</span></div><div class="" data-line-number="296">       <span class="token comment" spellcheck="true"> // if the WordPress role of the user overrides LDAP groups</span></div><div class="" data-line-number="297">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$authLDAPGroupEnable</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$authLDAPGroupOverUser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="298">            <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token function">authLdap_user_role<span class="token punctuation">(</span></span><span class="token variable">$uid</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="299">        <span class="token punctuation">}</span></div><div class="" data-line-number="300"><span>&nbsp;</span></div><div class="" data-line-number="301">       <span class="token comment" spellcheck="true"> // do LDAP group mapping if needed</span></div><div class="" data-line-number="302">       <span class="token comment" spellcheck="true"> // (if LDAP groups override worpress user role, $role is still empty)</span></div><div class="" data-line-number="303">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty<span class="token punctuation">(</span></span><span class="token variable">$role</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$authLDAPGroupEnable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="304">            <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token function">authLdap_groupmap<span class="token punctuation">(</span></span><span class="token variable">$realuid</span><span class="token punctuation">,</span> <span class="token variable">$dn</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="305">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'role from group mapping: '</span> <span class="token punctuation">.</span> <span class="token variable">$role</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="306">        <span class="token punctuation">}</span></div><div class="" data-line-number="307"><span>&nbsp;</span></div><div class="" data-line-number="308">       <span class="token comment" spellcheck="true"> // if we don't have a role yet, use default role</span></div><div class="" data-line-number="309">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty<span class="token punctuation">(</span></span><span class="token variable">$role</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty<span class="token punctuation">(</span></span><span class="token variable">$authLDAPDefaultRole</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="310">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'no role yet, set default role'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="311">            <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token variable">$authLDAPDefaultRole</span><span class="token punctuation">;</span></div><div class="" data-line-number="312">        <span class="token punctuation">}</span></div><div class="" data-line-number="313"><span>&nbsp;</span></div><div class="" data-line-number="314">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty<span class="token punctuation">(</span></span><span class="token variable">$role</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="315">           <span class="token comment" spellcheck="true"> // Sorry, but you are not in any group that is allowed access</span></div><div class="" data-line-number="316">            <span class="token function">trigger_error<span class="token punctuation">(</span></span><span class="token string">'no group found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="317">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'user is not in any group that is allowed access'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="318">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="319">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="320">            <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WP_Roles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="321">           <span class="token comment" spellcheck="true"> // not sure if this is needed, but it can't hurt</span></div><div class="" data-line-number="322">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$roles</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">is_role<span class="token punctuation">(</span></span><span class="token variable">$role</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="323">                <span class="token function">trigger_error<span class="token punctuation">(</span></span><span class="token string">'no group found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="324">                <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'role is invalid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="325">                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="326">            <span class="token punctuation">}</span></div><div class="" data-line-number="327">        <span class="token punctuation">}</span></div><div class="" data-line-number="328"><span>&nbsp;</span></div><div class="" data-line-number="329">       <span class="token comment" spellcheck="true"> // from here on, the user has access!</span></div><div class="" data-line-number="330">       <span class="token comment" spellcheck="true"> // now, lets update some user details</span></div><div class="" data-line-number="331">        <span class="token variable">$user_info</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="332">        <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_login'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$realuid</span><span class="token punctuation">;</span></div><div class="" data-line-number="333">        <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$role</span><span class="token punctuation">;</span></div><div class="" data-line-number="334">        <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="335"><span>&nbsp;</span></div><div class="" data-line-number="336">       <span class="token comment" spellcheck="true"> // first name</span></div><div class="" data-line-number="337">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPNameAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="338">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPNameAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="339">        <span class="token punctuation">}</span></div><div class="" data-line-number="340"><span>&nbsp;</span></div><div class="" data-line-number="341">       <span class="token comment" spellcheck="true"> // last name</span></div><div class="" data-line-number="342">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPSecName</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="343">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'last_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPSecName</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="344">        <span class="token punctuation">}</span></div><div class="" data-line-number="345"><span>&nbsp;</span></div><div class="" data-line-number="346">       <span class="token comment" spellcheck="true"> // mail address</span></div><div class="" data-line-number="347">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPMailAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="348">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPMailAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="349">        <span class="token punctuation">}</span></div><div class="" data-line-number="350"><span>&nbsp;</span></div><div class="" data-line-number="351">       <span class="token comment" spellcheck="true"> // website</span></div><div class="" data-line-number="352">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPWebAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="353">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$attribs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPWebAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="354">        <span class="token punctuation">}</span></div><div class="" data-line-number="355"><span>&nbsp;</span></div><div class="" data-line-number="356">       <span class="token comment" spellcheck="true"> // display name, nickname, nicename</span></div><div class="" data-line-number="357">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists<span class="token punctuation">(</span></span><span class="token string">'first_name'</span><span class="token punctuation">,</span> <span class="token variable">$user_info</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="358">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'display_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="359">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="360">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_nicename'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sanitize_title_with_dashes<span class="token punctuation">(</span></span><span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'first_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="361">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists<span class="token punctuation">(</span></span><span class="token string">'last_name'</span><span class="token punctuation">,</span> <span class="token variable">$user_info</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="362">                <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'display_name'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span> <span class="token punctuation">.</span> <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'last_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="363">                <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">' '</span> <span class="token punctuation">.</span> <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'last_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="364">                <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_nicename'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'_'</span> <span class="token punctuation">.</span> <span class="token function">sanitize_title_with_dashes<span class="token punctuation">(</span></span><span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'last_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="365">            <span class="token punctuation">}</span></div><div class="" data-line-number="366">        <span class="token punctuation">}</span></div><div class="" data-line-number="367"><span>&nbsp;</span></div><div class="" data-line-number="368">       <span class="token comment" spellcheck="true"> // optionally store the password into the wordpress database</span></div><div class="" data-line-number="369">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'CachePW'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="370">           <span class="token comment" spellcheck="true"> // Password will be hashed inside wp_update_user or wp_insert_user</span></div><div class="" data-line-number="371">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_pass'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span></div><div class="" data-line-number="372">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="373">           <span class="token comment" spellcheck="true"> // clear the password</span></div><div class="" data-line-number="374">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'user_pass'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="375">        <span class="token punctuation">}</span></div><div class="" data-line-number="376"><span>&nbsp;</span></div><div class="" data-line-number="377">       <span class="token comment" spellcheck="true"> // add uid if user exists</span></div><div class="" data-line-number="378">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$uid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="379">           <span class="token comment" spellcheck="true"> // found user in the database</span></div><div class="" data-line-number="380">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'The LDAP user has an entry in the WP-Database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="381">            <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$uid</span><span class="token punctuation">;</span></div><div class="" data-line-number="382">            unset <span class="token punctuation">(</span><span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'display_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$user_info</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="383">            <span class="token variable">$userid</span> <span class="token operator">=</span> <span class="token function">wp_update_user<span class="token punctuation">(</span></span><span class="token variable">$user_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="384">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="385">           <span class="token comment" spellcheck="true"> // new wordpress account will be created</span></div><div class="" data-line-number="386">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'The LDAP user does not have an entry in the WP-Database, a new WP account will be created'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="387"><span>&nbsp;</span></div><div class="" data-line-number="388">            <span class="token variable">$userid</span> <span class="token operator">=</span> <span class="token function">wp_insert_user<span class="token punctuation">(</span></span><span class="token variable">$user_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="389">        <span class="token punctuation">}</span></div><div class="" data-line-number="390"><span>&nbsp;</span></div><div class="" data-line-number="391">       <span class="token comment" spellcheck="true"> // if the user exists, wp_insert_user will update the existing user record</span></div><div class="" data-line-number="392">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_wp_error<span class="token punctuation">(</span></span><span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="393">            <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Error creating user : '</span> <span class="token punctuation">.</span> <span class="token variable">$userid</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_error_message<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="394">            <span class="token function">trigger_error<span class="token punctuation">(</span></span><span class="token string">'Error creating user: '</span> <span class="token punctuation">.</span> <span class="token variable">$userid</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_error_message<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="395">            <span class="token keyword">return</span> <span class="token variable">$userid</span><span class="token punctuation">;</span></div><div class="" data-line-number="396">        <span class="token punctuation">}</span></div><div class="" data-line-number="397"><span>&nbsp;</span></div><div class="" data-line-number="398">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'user id = '</span> <span class="token punctuation">.</span> <span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="399"><span>&nbsp;</span></div><div class="" data-line-number="400">       <span class="token comment" spellcheck="true"> // flag the user as an ldap user so we can hide the password fields in the user profile</span></div><div class="" data-line-number="401">        <span class="token function">update_user_meta<span class="token punctuation">(</span></span><span class="token variable">$userid</span><span class="token punctuation">,</span> <span class="token string">'authLDAP'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="402"><span>&nbsp;</span></div><div class="" data-line-number="403">       <span class="token comment" spellcheck="true"> // return a user object upon positive authorization</span></div><div class="" data-line-number="404">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WP_User</span><span class="token punctuation">(</span><span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="405">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="406">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'. Exception thrown in line '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getLine<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="407">        <span class="token function">trigger_error<span class="token punctuation">(</span></span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'. Exception thrown in line '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getLine<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="408">    <span class="token punctuation">}</span></div><div class="" data-line-number="409"><span class="token punctuation">}</span></div><div class="" data-line-number="410"><span>&nbsp;</span></div><div class="" data-line-number="411"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="412"> * Get user's user id</div><div class="" data-line-number="413"> *</div><div class="" data-line-number="414"> * Returns null if username not found</div><div class="" data-line-number="415"> *</div><div class="" data-line-number="416"> * @param string $username username</div><div class="" data-line-number="417"> * @param string user id, null if not found</div><div class="" data-line-number="418"> */</div><div class="" data-line-number="419"><span class="token keyword">function</span> <span class="token function">authLdap_get_uid<span class="token punctuation">(</span></span><span class="token variable">$username</span><span class="token punctuation">)</span></div><div class="" data-line-number="420"><span class="token punctuation">{</span></div><div class="" data-line-number="421">    <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">;</span></div><div class="" data-line-number="422"><span>&nbsp;</span></div><div class="" data-line-number="423">   <span class="token comment" spellcheck="true"> // find out whether the user is already present in the database</span></div><div class="" data-line-number="424">    <span class="token variable">$uid</span> <span class="token operator">=</span> <span class="token variable">$wpdb</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_var<span class="token punctuation">(</span></span></div><div class="" data-line-number="425">        <span class="token variable">$wpdb</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">prepare<span class="token punctuation">(</span></span></div><div class="" data-line-number="426">            <span class="token string">"SELECT ID FROM {$wpdb-&gt;users} WHERE user_login = %s"</span><span class="token punctuation">,</span></div><div class="" data-line-number="427">            <span class="token variable">$username</span></div><div class="" data-line-number="428">        <span class="token punctuation">)</span></div><div class="" data-line-number="429">    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="430">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$uid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="431">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">"Existing user, uid = {$uid}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="432">        <span class="token keyword">return</span> <span class="token variable">$uid</span><span class="token punctuation">;</span></div><div class="" data-line-number="433">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="434">        <span class="token keyword">return</span>  <span class="token keyword">null</span><span class="token punctuation">;</span></div><div class="" data-line-number="435">    <span class="token punctuation">}</span></div><div class="" data-line-number="436"><span class="token punctuation">}</span></div><div class="" data-line-number="437"><span>&nbsp;</span></div><div class="" data-line-number="438"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="439"> * Get the user's current role</div><div class="" data-line-number="440"> *</div><div class="" data-line-number="441"> * Returns empty string if not found.</div><div class="" data-line-number="442"> *</div><div class="" data-line-number="443"> * @param int $uid wordpress user id</div><div class="" data-line-number="444"> * @return string role, empty if none found</div><div class="" data-line-number="445"> */</div><div class="" data-line-number="446"><span class="token keyword">function</span> <span class="token function">authLdap_user_role<span class="token punctuation">(</span></span><span class="token variable">$uid</span><span class="token punctuation">)</span></div><div class="" data-line-number="447"><span class="token punctuation">{</span></div><div class="" data-line-number="448">    <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">;</span></div><div class="" data-line-number="449"><span>&nbsp;</span></div><div class="" data-line-number="450">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$uid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="451">        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="452">    <span class="token punctuation">}</span></div><div class="" data-line-number="453"><span>&nbsp;</span></div><div class="" data-line-number="454">    <span class="token variable">$meta_value</span> <span class="token operator">=</span> <span class="token variable">$wpdb</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_var<span class="token punctuation">(</span></span><span class="token string">"SELECT meta_value FROM {$wpdb-&gt;usermeta} WHERE meta_key = '{$wpdb-&gt;prefix}capabilities' AND user_id = {$uid}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="455"><span>&nbsp;</span></div><div class="" data-line-number="456">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$meta_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="457">        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="458">    <span class="token punctuation">}</span></div><div class="" data-line-number="459"><span>&nbsp;</span></div><div class="" data-line-number="460">    <span class="token variable">$capabilities</span> <span class="token operator">=</span> <span class="token function">unserialize<span class="token punctuation">(</span></span><span class="token variable">$meta_value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="461">    <span class="token variable">$roles</span> <span class="token operator">=</span> <span class="token function">is_array<span class="token punctuation">(</span></span><span class="token variable">$capabilities</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">array_keys<span class="token punctuation">(</span></span><span class="token variable">$capabilities</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="462">    <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="463"><span>&nbsp;</span></div><div class="" data-line-number="464">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">"Existing user's role: {$role}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="465">    <span class="token keyword">return</span> <span class="token variable">$role</span><span class="token punctuation">;</span></div><div class="" data-line-number="466"><span class="token punctuation">}</span></div><div class="" data-line-number="467"><span>&nbsp;</span></div><div class="" data-line-number="468"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="469"> * Get LDAP groups for user and map to role</div><div class="" data-line-number="470"> *</div><div class="" data-line-number="471"> * @param string $username</div><div class="" data-line-number="472"> * @param string $dn</div><div class="" data-line-number="473"> * @return string role, empty string if no mapping found, first found role otherwise</div><div class="" data-line-number="474"> * @conf array authLDAPGroups, associative array, role =&gt; ldap_group</div><div class="" data-line-number="475"> * @conf string authLDAPGroupAttr, ldap attribute that holds name of group</div><div class="" data-line-number="476"> * @conf string authLDAPGroupFilter, LDAP filter to find groups. can contain %s and %dn% placeholders</div><div class="" data-line-number="477"> */</div><div class="annotation">Method `authLdap_groupmap` is too long</div><div class="" data-line-number="478"><span class="token keyword">function</span> <span class="token function">authLdap_groupmap<span class="token punctuation">(</span></span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$dn</span><span class="token punctuation">)</span></div><div class="" data-line-number="479"><span class="token punctuation">{</span></div><div class="" data-line-number="480">    <span class="token variable">$authLDAPGroups</span>         <span class="token operator">=</span> <span class="token function">authLdap_sort_roles_by_capabilities<span class="token punctuation">(</span></span></div><div class="" data-line-number="481">        <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'Groups'</span><span class="token punctuation">)</span></div><div class="" data-line-number="482">    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="483">    <span class="token variable">$authLDAPGroupAttr</span>      <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupAttr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="484">    <span class="token variable">$authLDAPGroupFilter</span>    <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupFilter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="annotation">The variable name, `authLDAPGroupSeparator`, is too long</div><div class="" data-line-number="485">    <span class="token variable">$authLDAPGroupSeparator</span> <span class="token operator">=</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token string">'GroupSeparator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="486">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPGroupAttr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="487">        <span class="token variable">$authLDAPGroupAttr</span> <span class="token operator">=</span> <span class="token string">'gidNumber'</span><span class="token punctuation">;</span></div><div class="" data-line-number="488">    <span class="token punctuation">}</span></div><div class="" data-line-number="489">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPGroupFilter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="490">        <span class="token variable">$authLDAPGroupFilter</span> <span class="token operator">=</span> <span class="token string">'(&amp;(objectClass=posixGroup)(memberUid=%s))'</span><span class="token punctuation">;</span></div><div class="" data-line-number="491">    <span class="token punctuation">}</span></div><div class="" data-line-number="492">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$authLDAPGroupSeparator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="493">        <span class="token variable">$authLDAPGroupSeparator</span> <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">;</span></div><div class="" data-line-number="494">    <span class="token punctuation">}</span></div><div class="" data-line-number="495"><span>&nbsp;</span></div><div class="" data-line-number="496">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroups</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">count<span class="token punctuation">(</span></span><span class="token function">array_filter<span class="token punctuation">(</span></span><span class="token function">array_values<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroups</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="497">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'No group names defined'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="498">        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="499">    <span class="token punctuation">}</span></div><div class="" data-line-number="500"><span>&nbsp;</span></div><div class="" data-line-number="501">    <span class="token keyword">try</span> <span class="token punctuation">{</span></div><div class="" data-line-number="502">       <span class="token comment" spellcheck="true"> // To allow searches based on the DN instead of the uid, we replace the</span></div><div class="" data-line-number="503">       <span class="token comment" spellcheck="true"> // string %dn% with the users DN.</span></div><div class="" data-line-number="504">        <span class="token variable">$authLDAPGroupFilter</span> <span class="token operator">=</span> <span class="token function">str_replace<span class="token punctuation">(</span></span><span class="token string">'%dn%'</span><span class="token punctuation">,</span> <span class="token variable">$dn</span><span class="token punctuation">,</span> <span class="token variable">$authLDAPGroupFilter</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="505">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Group Filter: '</span> <span class="token punctuation">.</span> <span class="token function">json_encode<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroupFilter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="506">        <span class="token variable">$groups</span> <span class="token operator">=</span> <span class="token function">authLdap_get_server<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">search<span class="token punctuation">(</span></span><span class="token function">sprintf<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroupFilter</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$authLDAPGroupAttr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="507">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="508">        <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'Exception getting LDAP group attributes: '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="509">        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="510">    <span class="token punctuation">}</span></div><div class="" data-line-number="511"><span>&nbsp;</span></div><div class="" data-line-number="512">    <span class="token variable">$grp</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="513">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$groups</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="514">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token variable">$groups</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroupAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="515">            <span class="token variable">$grp</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$groups</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">strtolower<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroupAttr</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="516">        <span class="token punctuation">}</span></div><div class="" data-line-number="517">    <span class="token punctuation">}</span></div><div class="" data-line-number="518"><span>&nbsp;</span></div><div class="" data-line-number="519">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">'LDAP groups: '</span> <span class="token punctuation">.</span> <span class="token function">json_encode<span class="token punctuation">(</span></span><span class="token variable">$grp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="520"><span>&nbsp;</span></div><div class="" data-line-number="521">   <span class="token comment" spellcheck="true"> // Check whether the user is member of one of the groups that are</span></div><div class="" data-line-number="522">   <span class="token comment" spellcheck="true"> // allowed acces to the blog. If the user is not member of one of</span></div><div class="" data-line-number="523">   <span class="token comment" spellcheck="true"> // The groups throw her out! ;-)</span></div><div class="" data-line-number="524">   <span class="token comment" spellcheck="true"> // If the user is member of more than one group only the first one</span></div><div class="" data-line-number="525">   <span class="token comment" spellcheck="true"> // will be taken into account!</span></div><div class="" data-line-number="526"><span>&nbsp;</span></div><div class="" data-line-number="527">    <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></div><div class="" data-line-number="528">    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$authLDAPGroups</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="529">        <span class="token variable">$currentGroup</span> <span class="token operator">=</span> <span class="token function">explode<span class="token punctuation">(</span></span><span class="token variable">$authLDAPGroupSeparator</span><span class="token punctuation">,</span> <span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="530">       <span class="token comment" spellcheck="true"> // Remove whitespaces around the group-ID</span></div><div class="" data-line-number="531">        <span class="token variable">$currentGroup</span> <span class="token operator">=</span> <span class="token function">array_map<span class="token punctuation">(</span></span><span class="token string">'trim'</span><span class="token punctuation">,</span> <span class="token variable">$currentGroup</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="532">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;</span> <span class="token function">count<span class="token punctuation">(</span></span><span class="token function">array_intersect<span class="token punctuation">(</span></span><span class="token variable">$currentGroup</span><span class="token punctuation">,</span> <span class="token variable">$grp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="533">            <span class="token variable">$role</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span></div><div class="" data-line-number="534">            <span class="token keyword">break</span><span class="token punctuation">;</span></div><div class="" data-line-number="535">        <span class="token punctuation">}</span></div><div class="" data-line-number="536">    <span class="token punctuation">}</span></div><div class="" data-line-number="537"><span>&nbsp;</span></div><div class="" data-line-number="538">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token string">"Role from LDAP group: {$role}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="539">    <span class="token keyword">return</span> <span class="token variable">$role</span><span class="token punctuation">;</span></div><div class="" data-line-number="540"><span class="token punctuation">}</span></div><div class="" data-line-number="541"><span>&nbsp;</span></div><div class="" data-line-number="542"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="543"> * This function disables the password-change fields in the users preferences.</div><div class="" data-line-number="544"> *</div><div class="" data-line-number="545"> * It does not make sense to authenticate via LDAP and then allow the user to</div><div class="" data-line-number="546"> * change the password only in the wordpress database. And changing the password</div><div class="" data-line-number="547"> * LDAP-wide can not be the scope of Wordpress!</div><div class="" data-line-number="548"> *</div><div class="" data-line-number="549"> * Whether the user is an LDAP-User or not is determined using the authLDAP-Flag</div><div class="" data-line-number="550"> * of the users meta-informations</div><div class="" data-line-number="551"> *</div><div class="" data-line-number="552"> * @return false, if the user whose prefs are viewed is an LDAP-User, true if</div><div class="" data-line-number="553"> * he isn't</div><div class="" data-line-number="554"> * @conf boolean authLDAP</div><div class="" data-line-number="555"> */</div><div class="" data-line-number="556"><span class="token keyword">function</span> <span class="token function">authLdap_show_password_fields<span class="token punctuation">(</span></span><span class="token variable">$return</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">)</span></div><div class="" data-line-number="557"><span class="token punctuation">{</span></div><div class="" data-line-number="558">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="559">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><div class="" data-line-number="560">    <span class="token punctuation">}</span></div><div class="" data-line-number="561"><span>&nbsp;</span></div><div class="" data-line-number="562">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_user_meta<span class="token punctuation">(</span></span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">ID</span><span class="token punctuation">,</span> <span class="token string">'authLDAP'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="563">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="564">    <span class="token punctuation">}</span></div><div class="" data-line-number="565"><span>&nbsp;</span></div><div class="" data-line-number="566">    <span class="token keyword">return</span> <span class="token variable">$return</span><span class="token punctuation">;</span></div><div class="" data-line-number="567"><span class="token punctuation">}</span></div><div class="" data-line-number="568"><span>&nbsp;</span></div><div class="" data-line-number="569"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="570"> * This function disables the password reset for a user.</div><div class="" data-line-number="571"> *</div><div class="" data-line-number="572"> * It does not make sense to authenticate via LDAP and then allow the user to</div><div class="" data-line-number="573"> * reset the password only in the wordpress database. And changing the password</div><div class="" data-line-number="574"> * LDAP-wide can not be the scope of Wordpress!</div><div class="" data-line-number="575"> *</div><div class="" data-line-number="576"> * Whether the user is an LDAP-User or not is determined using the authLDAP-Flag</div><div class="" data-line-number="577"> * of the users meta-informations</div><div class="" data-line-number="578"> *</div><div class="" data-line-number="579"> * @author chaplina (https://github.com/chaplina)</div><div class="" data-line-number="580"> * @conf boolean authLDAP</div><div class="" data-line-number="581"> * @return false, if the user is an LDAP-User, true if he isn't</div><div class="" data-line-number="582"> */</div><div class="" data-line-number="583"><span class="token keyword">function</span> <span class="token function">authLdap_allow_password_reset<span class="token punctuation">(</span></span><span class="token variable">$return</span><span class="token punctuation">,</span> <span class="token variable">$userid</span><span class="token punctuation">)</span></div><div class="" data-line-number="584"><span class="token punctuation">{</span></div><div class="" data-line-number="585">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$userid</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="586">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><div class="" data-line-number="587">    <span class="token punctuation">}</span></div><div class="" data-line-number="588"><span>&nbsp;</span></div><div class="" data-line-number="589">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_user_meta<span class="token punctuation">(</span></span><span class="token variable">$userid</span><span class="token punctuation">,</span> <span class="token string">'authLDAP'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="590">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="591">    <span class="token punctuation">}</span></div><div class="" data-line-number="592">    <span class="token keyword">return</span> <span class="token variable">$return</span><span class="token punctuation">;</span></div><div class="" data-line-number="593"><span class="token punctuation">}</span></div><div class="" data-line-number="594"><span>&nbsp;</span></div><div class="" data-line-number="595"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="596"> * Sort the given roles by number of capabilities</div><div class="" data-line-number="597"> *</div><div class="" data-line-number="598"> * @param array $roles</div><div class="" data-line-number="599"> *</div><div class="" data-line-number="600"> * @return array</div><div class="" data-line-number="601"> */</div><div class="" data-line-number="602"><span class="token keyword">function</span> <span class="token function">authLdap_sort_roles_by_capabilities<span class="token punctuation">(</span></span><span class="token variable">$roles</span><span class="token punctuation">)</span></div><div class="" data-line-number="603"><span class="token punctuation">{</span></div><div class="" data-line-number="604">    <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">;</span></div><div class="" data-line-number="605">    <span class="token variable">$myRoles</span> <span class="token operator">=</span> <span class="token function">get_option<span class="token punctuation">(</span></span><span class="token variable">$wpdb</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get_blog_prefix<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'user_roles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="606"><span>&nbsp;</span></div><div class="" data-line-number="607">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token function">print_r<span class="token punctuation">(</span></span><span class="token variable">$roles</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="608">    <span class="token function">uasort<span class="token punctuation">(</span></span><span class="token variable">$myRoles</span><span class="token punctuation">,</span> <span class="token string">'authLdap_sortByCapabilitycount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="609"><span>&nbsp;</span></div><div class="" data-line-number="610">    <span class="token variable">$return</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="611"><span>&nbsp;</span></div><div class="" data-line-number="612">    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$myRoles</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="613">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="614">            <span class="token variable">$return</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$roles</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="615">        <span class="token punctuation">}</span></div><div class="" data-line-number="616">    <span class="token punctuation">}</span></div><div class="" data-line-number="617"><span>&nbsp;</span></div><div class="" data-line-number="618">    <span class="token function">authLdap_debug<span class="token punctuation">(</span></span><span class="token function">print_r<span class="token punctuation">(</span></span><span class="token variable">$return</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="619">    <span class="token keyword">return</span> <span class="token variable">$return</span><span class="token punctuation">;</span></div><div class="" data-line-number="620"><span class="token punctuation">}</span></div><div class="" data-line-number="621"><span>&nbsp;</span></div><div class="" data-line-number="622"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="623"> * Sort according to the number of capabilities</div><div class="" data-line-number="624"> *</div><div class="" data-line-number="625"> * @param $a</div><div class="" data-line-number="626"> * @param $b</div><div class="" data-line-number="627"> */</div><div class="" data-line-number="628"><span class="token keyword">function</span> <span class="token function">authLdap_sortByCapabilitycount<span class="token punctuation">(</span></span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span></div><div class="" data-line-number="629"><span class="token punctuation">{</span></div><div class="" data-line-number="630">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count<span class="token punctuation">(</span></span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token string">'capabilities'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">count<span class="token punctuation">(</span></span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token string">'capabilities'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="631">        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></div><div class="" data-line-number="632">    <span class="token punctuation">}</span></div><div class="" data-line-number="633">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count<span class="token punctuation">(</span></span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token string">'capabilities'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">count<span class="token punctuation">(</span></span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token string">'capabilities'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="634">        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span></div><div class="" data-line-number="635">    <span class="token punctuation">}</span></div><div class="" data-line-number="636"><span>&nbsp;</span></div><div class="" data-line-number="637">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></div><div class="" data-line-number="638"><span class="token punctuation">}</span></div><div class="" data-line-number="639"><span>&nbsp;</span></div><div class="" data-line-number="640"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="641"> * Load AuthLDAP Options</div><div class="" data-line-number="642"> *</div><div class="" data-line-number="643"> * Sets and stores defaults if options are not up to date</div><div class="" data-line-number="644"> */</div><div class="annotation">Method `authLdap_load_options` is too long</div><div class="" data-line-number="645"><span class="token keyword">function</span> <span class="token function">authLdap_load_options<span class="token punctuation">(</span></span><span class="token variable">$reload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div><div class="" data-line-number="646"><span class="token punctuation">{</span></div><div class="" data-line-number="647">    <span class="token keyword">static</span> <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><div class="" data-line-number="648"><span>&nbsp;</span></div><div class="" data-line-number="649">   <span class="token comment" spellcheck="true"> // the current version for options</span></div><div class="annotation">The variable name, `option_version_plugin`, is too long</div><div class="" data-line-number="650">    <span class="token variable">$option_version_plugin</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></div><div class="" data-line-number="651"><span>&nbsp;</span></div><div class="" data-line-number="652">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null<span class="token punctuation">(</span></span><span class="token variable">$options</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$reload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="653">        <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token function">get_option<span class="token punctuation">(</span></span><span class="token string">'authLDAPOptions'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="654">    <span class="token punctuation">}</span></div><div class="" data-line-number="655"><span>&nbsp;</span></div><div class="" data-line-number="656">   <span class="token comment" spellcheck="true"> // check if option version has changed (or if it's there at all)</span></div><div class="" data-line-number="657">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'Version'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'Version'</span><span class="token punctuation">]</span> <span class="token operator">!</span><span class="token operator">=</span> <span class="token variable">$option_version_plugin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="658">       <span class="token comment" spellcheck="true"> // defaults for all options</span></div><div class="" data-line-number="659">        <span class="token variable">$options_default</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></div><div class="" data-line-number="660">            <span class="token string">'Enabled'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span></div><div class="" data-line-number="661">            <span class="token string">'CachePW'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span></div><div class="" data-line-number="662">            <span class="token string">'URI'</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span></div><div class="" data-line-number="663">            <span class="token string">'URISeparator'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">' '</span><span class="token punctuation">,</span></div><div class="" data-line-number="664">            <span class="token string">'Filter'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // '(uid=%s)'</span></div><div class="" data-line-number="665">            <span class="token string">'NameAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // 'name'</span></div><div class="" data-line-number="666">            <span class="token string">'SecName'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span></div><div class="" data-line-number="667">            <span class="token string">'UidAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // 'uid'</span></div><div class="" data-line-number="668">            <span class="token string">'MailAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // 'mail'</span></div><div class="" data-line-number="669">            <span class="token string">'WebAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span></div><div class="" data-line-number="670">            <span class="token string">'Groups'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><div class="" data-line-number="671">            <span class="token string">'Debug'</span>         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span></div><div class="" data-line-number="672">            <span class="token string">'GroupAttr'</span>     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // 'gidNumber'</span></div><div class="" data-line-number="673">            <span class="token string">'GroupFilter'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true"> // '(&amp;(objectClass=posixGroup)(memberUid=%s))'</span></div><div class="" data-line-number="674">            <span class="token string">'DefaultRole'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">''</span><span class="token punctuation">,</span></div><div class="" data-line-number="675">            <span class="token string">'GroupEnable'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div><div class="" data-line-number="676">            <span class="token string">'GroupOverUser'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div><div class="" data-line-number="677">            <span class="token string">'Version'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$option_version_plugin</span><span class="token punctuation">,</span></div><div class="" data-line-number="678">        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="679"><span>&nbsp;</span></div><div class="" data-line-number="680">       <span class="token comment" spellcheck="true"> // check if we got a version</span></div><div class="" data-line-number="681">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'Version'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="682">           <span class="token comment" spellcheck="true"> // we just changed to the new option format</span></div><div class="" data-line-number="683">           <span class="token comment" spellcheck="true"> // read old options, then delete them</span></div><div class="annotation">The variable name, `old_option_new_option`, is too long</div><div class="" data-line-number="684">            <span class="token variable">$old_option_new_option</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span></div><div class="" data-line-number="685">                <span class="token string">'authLDAP'</span>              <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Enabled'</span><span class="token punctuation">,</span></div><div class="" data-line-number="686">                <span class="token string">'authLDAPCachePW'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'CachePW'</span><span class="token punctuation">,</span></div><div class="" data-line-number="687">                <span class="token string">'authLDAPURI'</span>           <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'URI'</span><span class="token punctuation">,</span></div><div class="" data-line-number="688">                <span class="token string">'authLDAPFilter'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Filter'</span><span class="token punctuation">,</span></div><div class="" data-line-number="689">                <span class="token string">'authLDAPNameAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'NameAttr'</span><span class="token punctuation">,</span></div><div class="" data-line-number="690">                <span class="token string">'authLDAPSecName'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'SecName'</span><span class="token punctuation">,</span></div><div class="" data-line-number="691">                <span class="token string">'authLDAPUidAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'UidAttr'</span><span class="token punctuation">,</span></div><div class="" data-line-number="692">                <span class="token string">'authLDAPMailAttr'</span>      <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'MailAttr'</span><span class="token punctuation">,</span></div><div class="" data-line-number="693">                <span class="token string">'authLDAPWebAttr'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'WebAttr'</span><span class="token punctuation">,</span></div><div class="" data-line-number="694">                <span class="token string">'authLDAPGroups'</span>        <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Groups'</span><span class="token punctuation">,</span></div><div class="" data-line-number="695">                <span class="token string">'authLDAPDebug'</span>         <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'Debug'</span><span class="token punctuation">,</span></div><div class="" data-line-number="696">                <span class="token string">'authLDAPGroupAttr'</span>     <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'GroupAttr'</span><span class="token punctuation">,</span></div><div class="" data-line-number="697">                <span class="token string">'authLDAPGroupFilter'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'GroupFilter'</span><span class="token punctuation">,</span></div><div class="" data-line-number="698">                <span class="token string">'authLDAPDefaultRole'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'DefaultRole'</span><span class="token punctuation">,</span></div><div class="" data-line-number="699">                <span class="token string">'authLDAPGroupEnable'</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'GroupEnable'</span><span class="token punctuation">,</span></div><div class="" data-line-number="700">                <span class="token string">'authLDAPGroupOverUser'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'GroupOverUser'</span><span class="token punctuation">,</span></div><div class="" data-line-number="701">            <span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="702">            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$old_option_new_option</span> <span class="token keyword">as</span> <span class="token variable">$old_option</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$new_option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="703">                <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">get_option<span class="token punctuation">(</span></span><span class="token variable">$old_option</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="704">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_null<span class="token punctuation">(</span></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="705">                    <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$new_option</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span></div><div class="" data-line-number="706">                <span class="token punctuation">}</span></div><div class="" data-line-number="707">                <span class="token function">delete_option<span class="token punctuation">(</span></span><span class="token variable">$old_option</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="708">            <span class="token punctuation">}</span></div><div class="" data-line-number="709">            <span class="token function">delete_option<span class="token punctuation">(</span></span><span class="token string">'authLDAPCookieMarker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="710">            <span class="token function">delete_option<span class="token punctuation">(</span></span><span class="token string">'authLDAPCookierMarker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="711">        <span class="token punctuation">}</span></div><div class="" data-line-number="712"><span>&nbsp;</span></div><div class="" data-line-number="713">       <span class="token comment" spellcheck="true"> // set default for all options that are missing</span></div><div class="" data-line-number="714">        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$options_default</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$default</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="715">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="716">                <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$default</span><span class="token punctuation">;</span></div><div class="" data-line-number="717">            <span class="token punctuation">}</span></div><div class="" data-line-number="718">        <span class="token punctuation">}</span></div><div class="" data-line-number="719"><span>&nbsp;</span></div><div class="" data-line-number="720">       <span class="token comment" spellcheck="true"> // set new version and save</span></div><div class="" data-line-number="721">        <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token string">'Version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$option_version_plugin</span><span class="token punctuation">;</span></div><div class="" data-line-number="722">        <span class="token function">update_option<span class="token punctuation">(</span></span><span class="token string">'authLDAPOptions'</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="723">    <span class="token punctuation">}</span></div><div class="" data-line-number="724">    <span class="token keyword">return</span> <span class="token variable">$options</span><span class="token punctuation">;</span></div><div class="" data-line-number="725"><span class="token punctuation">}</span></div><div class="" data-line-number="726"><span>&nbsp;</span></div><div class="" data-line-number="727"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="728"> * Get an individual option</div><div class="" data-line-number="729"> */</div><div class="" data-line-number="730"><span class="token keyword">function</span> <span class="token function">authLdap_get_option<span class="token punctuation">(</span></span><span class="token variable">$optionname</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></div><div class="" data-line-number="731"><span class="token punctuation">{</span></div><div class="" data-line-number="732">    <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token function">authLdap_load_options<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="733">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset<span class="token punctuation">(</span></span><span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$optionname</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$optionname</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="734">        <span class="token keyword">return</span> <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$optionname</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><div class="" data-line-number="735">    <span class="token punctuation">}</span></div><div class="" data-line-number="736"><span>&nbsp;</span></div><div class="" data-line-number="737">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!</span><span class="token operator">==</span> <span class="token variable">$default</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="738">        <span class="token keyword">return</span> <span class="token variable">$default</span><span class="token punctuation">;</span></div><div class="" data-line-number="739">    <span class="token punctuation">}</span></div><div class="" data-line-number="740"><span>&nbsp;</span></div><div class="" data-line-number="741">   <span class="token comment" spellcheck="true"> //authLdap_debug('option name invalid: ' . $optionname);</span></div><div class="" data-line-number="742">    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><div class="" data-line-number="743"><span class="token punctuation">}</span></div><div class="" data-line-number="744"><span>&nbsp;</span></div><div class="" data-line-number="745"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="746"> * Set new options</div><div class="" data-line-number="747"> */</div><div class="" data-line-number="748"><span class="token keyword">function</span> <span class="token function">authLdap_set_options<span class="token punctuation">(</span></span><span class="token variable">$new_options</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div><div class="" data-line-number="749"><span class="token punctuation">{</span></div><div class="" data-line-number="750">   <span class="token comment" spellcheck="true"> // initialize the options with what we currently have</span></div><div class="" data-line-number="751">    <span class="token variable">$options</span> <span class="token operator">=</span> <span class="token function">authLdap_load_options<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="752"><span>&nbsp;</span></div><div class="" data-line-number="753">   <span class="token comment" spellcheck="true"> // set the new options supplied</span></div><div class="" data-line-number="754">    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$new_options</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="755">        <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span></div><div class="" data-line-number="756">    <span class="token punctuation">}</span></div><div class="" data-line-number="757"><span>&nbsp;</span></div><div class="" data-line-number="758">   <span class="token comment" spellcheck="true"> // store options</span></div><div class="" data-line-number="759">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">update_option<span class="token punctuation">(</span></span><span class="token string">'authLDAPOptions'</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="760">       <span class="token comment" spellcheck="true"> // reload the option cache</span></div><div class="" data-line-number="761">        <span class="token function">authLdap_load_options<span class="token punctuation">(</span></span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="762"><span>&nbsp;</span></div><div class="" data-line-number="763">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><div class="" data-line-number="764">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><div class="" data-line-number="765">       <span class="token comment" spellcheck="true"> // could not set options</span></div><div class="" data-line-number="766">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="767">    <span class="token punctuation">}</span></div><div class="" data-line-number="768"><span class="token punctuation">}</span></div><div class="" data-line-number="769"><span>&nbsp;</span></div><div class="" data-line-number="770"><span class="token comment" spellcheck="true">/**</span></div><div class="" data-line-number="771"> * Do not send an email after changing the password or the email of the user!</div><div class="" data-line-number="772"> *</div><div class="" data-line-number="773"> * @param boolean $result      The initial resturn value</div><div class="" data-line-number="774"> * @param array   $user        The old userdata</div><div class="" data-line-number="775"> * @param array   $newUserData The changed userdata</div><div class="" data-line-number="776"> *</div><div class="" data-line-number="777"> * @return bool</div><div class="" data-line-number="778"> */</div><div class="" data-line-number="779"><span class="token keyword">function</span> <span class="token function">authLdap_send_change_email<span class="token punctuation">(</span></span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$newUserData</span><span class="token punctuation">)</span></div><div class="" data-line-number="780"><span class="token punctuation">{</span></div><div class="" data-line-number="781">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_usermeta<span class="token punctuation">(</span></span><span class="token variable">$user</span><span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'authLDAP'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="" data-line-number="782">        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><div class="" data-line-number="783">    <span class="token punctuation">}</span></div><div class="" data-line-number="784"><span>&nbsp;</span></div><div class="" data-line-number="785">    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span></div><div class="" data-line-number="786"><span class="token punctuation">}</span></div><div class="" data-line-number="787"><span>&nbsp;</span></div><div class="" data-line-number="788"><span class="token function">add_action<span class="token punctuation">(</span></span><span class="token string">'admin_menu'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_addmenu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="789"><span class="token function">add_filter<span class="token punctuation">(</span></span><span class="token string">'show_password_fields'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_show_password_fields'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="790"><span class="token function">add_filter<span class="token punctuation">(</span></span><span class="token string">'allow_password_reset'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_allow_password_reset'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="791"><span class="token function">add_filter<span class="token punctuation">(</span></span><span class="token string">'authenticate'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_login'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="792"><span class="token comment" spellcheck="true">/** This only works from WP 4.3.0 on */</span></div><div class="" data-line-number="793"><span class="token function">add_filter<span class="token punctuation">(</span></span><span class="token string">'send_password_change_email'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_send_change_email'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="" data-line-number="794"><span class="token function">add_filter<span class="token punctuation">(</span></span><span class="token string">'send_email_change_email'</span><span class="token punctuation">,</span> <span class="token string">'authLdap_send_change_email'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre></div></div></div></div></div><footer class="footer"><div class="container"><div class="cols"><div class="col col--size-5"><img alt="Code Climate" class="footer__logo" src="./codeclimate_bad_example_files/cc_logo_full-7f3dc0b3e3cbb7977658c09eb2bd9b6b.svg"><p class="footer__copy">¬©2017 Code Climate Inc</p></div><div class="col col--size-11"><ul class="footer__nav"><li class="footer__nav--title">Product</li><li><a href="https://codeclimate.com/features">Features</a></li><li><a href="https://codeclimate.com/pricing">Pricing</a></li><li><a href="https://codeclimate.com/oss">Open Source</a></li><li><a href="https://codeclimate.com/enterprise">Enterprise</a></li></ul><ul class="footer__nav"><li class="footer__nav--title">Support</li><li><a href="https://codeclimate.com/help">Help and Support</a></li><li><a href="https://docs.codeclimate.com/">Documentation</a></li><li><a href="http://status.codeclimate.com/">Status</a></li></ul><ul class="footer__nav"><li class="footer__nav--title">Company</li><li><a href="https://codeclimate.com/about">About</a></li><li><a href="http://jobs.codeclimate.com/?gh_src=41jar5">Careers</a></li><li><a href="https://codeclimate.com/legal/terms">Legal</a></li><li><a href="https://codeclimate.com/security">Security</a></li></ul><ul class="footer__nav"><li class="footer__nav--title">Social</li><li><a href="http://blog.codeclimate.com/">Blog</a></li><li><a href="https://www.facebook.com/codeclimate">Facebook</a></li><li><a href="https://www.twitter.com/codeclimate">Twitter</a></li></ul></div></div></div></footer>
<!-- This is a random-length HTML comment: hssdvsenwyrslhqguenhpopiskwjhhjjsfulzluyqcybooqtxvtnzfngcepnigvnanqeyrvmzgjakhkrmnjpgrzdxzbijoqciicfzfpkhhqnstuamvcooisvewkfpvhxgyaikbuuslpvdtnivzvblqbwjmumczoayjhgqdmqgkvrgykigmaxbfwexfbmgdgupjwdjqweqftjfeykoeoapjbcaiezzgiheiediiihhmvhkwjsrqcjsprnmrjmpmvjrmtwwophguckkmmzpicabxwbshjkjcqjjapukgbqcqeuhhlzjvnxucmb --><div class="remodal-overlay remodal-is-closed" style="display: none;"></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000003" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000004" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000005" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000006" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-f75bac77a7a153d4a44f53294a8e4249" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button><p>When classes take on too many responsibilities, they grow. A large number of instance variables or methods can make a class hard to understand. Large classes tend to have lower cohesion and higher churn.</p>

<p>Often large classes have methods that do not operate on all of the class state. Identifying the groups of data that are used together can point to seams to split out additional collaborator classes or value objects.</p>

<p>Another trick is to look for repeated prefixes or suffixes in method and variable names, or repeated parameter names, and use them to guide extractions.</p>

<h2>Refactorings</h2>

<ul>
<li><a href="http://sourcemaking.com/refactoring/extract-class">Extract Class</a></li>
<li><a href="http://sourcemaking.com/refactoring/extract-subclass">Extract Subclass</a></li>
<li><a href="http://sourcemaking.com/refactoring/replace-data-value-with-object">Replace Data Value with Object</a></li>
</ul>

<h2>Further Reading</h2>

<ul>
<li><a href="http://www.objectmentor.com/resources/articles/srp.pdf">Single Responsibility Principle</a></li>
<li><a href="http://sourcemaking.com/refactoring/large-class">Large Class</a> on SourceMaking</li>
<li><a href="http://www.amazon.com/Refactoring-Improving-Design-Existing-Code/dp/0201485672">Refactoring: Improving the Design of Existing Code</a> by Martin Fowler. <em>Large Class</em>, p78</li>
</ul>
</div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000008" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000a" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000007" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000c" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000009" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000b" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000d" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000e" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c21357800000f" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000010" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000011" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000012" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000013" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-remodal-id="readup-581d7cb2c22c213578000014" tabindex="-1"><button class="remodal__close" data-remodal-action="close">Close</button></div></div><div class="remodal-wrapper remodal-is-closed" style="display: none;"><div class="remodal remodal-is-initialized remodal-is-closed" data-ajax-remodal="" tabindex="-1"></div></div></body></html>